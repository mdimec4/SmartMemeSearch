<Page x:ConnectionId='1'
    x:Class="SmartMemeSearch.Views.MainPage"
    xmlns:model="using:SmartMemeSearch"
    xmlns:conv="using:SmartMemeSearch.Converters"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:SmartMemeSearch.ViewModels"
                        >

    <Page.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <conv:BoolToIndeterminateConverter x:Key="BoolToIndeterminateConverter"/>
        <conv:BoolToVisibilityInverseConverter x:Key="BoolToVisibilityInverseConverter"/>
        <MenuFlyout x:Key="MemeFlyout">
            <MenuFlyoutItem x:ConnectionId='2' Text="Open"                       />
            <MenuFlyoutItem x:ConnectionId='3' Text="Copy image"                            />
            <MenuFlyoutItem x:ConnectionId='4' Text="Copy file"                           />
            <MenuFlyoutItem x:ConnectionId='5' Text="Copy file path"                           />
            <MenuFlyoutItem x:ConnectionId='6' Text="Open folder"                             />
        </MenuFlyout>
    </Page.Resources>

    <Page.DataContext>
        <vm:MainViewModel />
    </Page.DataContext>

    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search box -->
        <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBox x:ConnectionId='24' x:Name="SearchBox"
                Width="400"
                PlaceholderText="Search memes..."
                Text="{Binding Query, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                           >

                <TextBox.KeyboardAccelerators>
                    <!-- Escape: Clear search -->
                    <KeyboardAccelerator x:ConnectionId='25' Key="Escape"
                                                             />

                    <!-- Ctrl+F already added -->
                </TextBox.KeyboardAccelerators>

            </TextBox>

            <Button Content="Manage Meme Folders"
                Command="{Binding ManageFoldersCommand}"/>

            <Button Content="Remove ads"
                Command="{Binding RemoveAdsCommand}"
                Margin="10,0,0,0"
                Visibility="{Binding IsPremium, Converter={StaticResource BoolToVisibilityInverseConverter}}"/>
        </StackPanel>
        <StackPanel Grid.Row="1" Margin="0,10,0,0">
            <ProgressBar Minimum="0" 
                 Maximum="1" 
                 Value="{Binding ProgressValue}" 
                 IsIndeterminate="{Binding IsImporting, Converter={StaticResource BoolToIndeterminateConverter}}"/>

            <TextBlock Text="{Binding CurrentFile}"
               FontSize="12"
               Foreground="Gray"
               TextWrapping="Wrap"/>

            <TextBlock Text="Importing..."
               Visibility="{Binding IsImporting, Converter={StaticResource BoolToVisibilityConverter}}"
               Foreground="DarkOrange"/>
        </StackPanel>

        <!-- Results -->
        <ListView x:ConnectionId='7' Grid.Row="2"
          ItemsSource="{Binding Results}"
          Margin="0,20,0,0"
          Padding="0,0,0,100"
          x:Name="ResultsList">

            <ListView.KeyboardAccelerators>

                <!-- Enter = Open -->
                <KeyboardAccelerator x:ConnectionId='9' Key="Enter"
                                                      />

                <!-- Ctrl+C = Copy image -->
                <KeyboardAccelerator x:ConnectionId='10' Key="C"
                             Modifiers="Control"
                                                           />

                <!-- OPTIONAL: Ctrl+Shift+C = Copy file path -->
                <KeyboardAccelerator x:ConnectionId='11' Key="C"
                             Modifiers="Control,Shift"
                                                          />

                <KeyboardAccelerator x:ConnectionId='12' Key="F"
                     Modifiers="Control"
                                                     />

            </ListView.KeyboardAccelerators>

            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>

                    <!-- hover effect -->
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListViewItem">
                                <Grid x:Name="RootGrid" Background="Transparent">

                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup x:Name="CommonStates">

                                            <VisualState x:Name="Normal" />

                                            <VisualState x:Name="PointerOver">
                                                <VisualState.Setters>
                                                    <Setter Target="RootGrid.Background"
                                                    Value="#22000000"/>
                                                </VisualState.Setters>
                                            </VisualState>

                                            <VisualState x:Name="Pressed">
                                                <VisualState.Setters>
                                                    <Setter Target="RootGrid.Background"
                                                    Value="#33000000"/>
                                                </VisualState.Setters>
                                            </VisualState>

                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>

                                    <ContentPresenter
                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                Margin="4"/>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>

                </Style>
            </ListView.ItemContainerStyle>

            <!-- ItemTemplate from step 1 here -->
            <ListView.ItemTemplate>
                <DataTemplate                                >
                    <Grid x:ConnectionId='20'
                        Background="Transparent"
                                                              
                        ContextFlyout="{StaticResource MemeFlyout}"
                        Padding="4">

                        <StackPanel Orientation="Horizontal" Spacing="12">

                            <Image Source="{Binding Thumbnail}"
                               Width="120" Height="120"
                               Stretch="UniformToFill"
                               Margin="0,0,8,0"/>

                            <StackPanel>
                                <TextBlock x:ConnectionId='21'                          FontSize="14"/>
                                <TextBlock x:ConnectionId='22'                       FontSize="12" Foreground="Gray"/>
                                <TextBlock x:ConnectionId='23'                           
                                   TextWrapping="Wrap"
                                   FontSize="12"
                                   Foreground="#666"/>
                            </StackPanel>

                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>

        </ListView>

        <Border Grid.Row="3"
        BorderBrush="#33000000"
        BorderThickness="1"
        Margin="0,6,0,0"
        CornerRadius="6"
        Padding="0,4,0,0"
        Visibility="{Binding IsPremium, Converter={StaticResource BoolToVisibilityInverseConverter}}">

            <WebView2 x:ConnectionId='8' x:Name="AdsView"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Top"
              Height="80"
              DefaultBackgroundColor="Transparent"/>
        </Border>



    </Grid>
</Page>

